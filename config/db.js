/**
 * [FILE: config/db.js]
 * 역할: 서비스 운영에 필요한 모든 데이터가 저장된 MySQL 데이터베이스와의 통로를 개설합니다.
 * 주요 기능: DB 접속 정보 설정, 연결 시도 및 성공/실패 여부 출력
 */

// 1. MySQL 엔진 로드
// 'mysql2' 라이브러리를 사용하여 데이터베이스와 통신할 수 있는 기능을 불러옵니다.
const mysql = require('mysql2');

// ---------------------------------------------------------
// 2. MySQL(DB) 연결 설정 (창고 열쇠 제작)
// ---------------------------------------------------------
// 서버가 DB에 접속하기 위해 필요한 '신분증'과 같은 정보를 설정합니다.
const db = mysql.createConnection({
    // 데이터베이스 서버의 위치 (현재는 서버와 DB가 같은 컴퓨터에 있으므로 localhost)
    host: 'localhost',       

    // DB 접속용 사용자 계정 (AWS 서버 설정과 동일하게 맞춘 'taedoll')
    user: 'taedoll',         

    // DB 접속용 비밀번호 (설치 시 설정한 비밀번호)
    // ⚠️ 주의: 윈도우 환경과 AWS 환경의 비밀번호가 다를 수 있으니 배포 시 확인 필수!
    password: '1234',        

    // 접속 후 사용할 데이터베이스의 이름 (우리가 생성한 smash_db)
    database: 'smash_db'     
});

// ---------------------------------------------------------
// 3. 데이터베이스 연결 실행 (문 열기)
// ---------------------------------------------------------
// 위에서 만든 설정(db)을 바탕으로 실제 연결을 시도합니다.
db.connect((err) => {
    // 연결 도중 에러가 발생한 경우 (비밀번호 틀림, DB 꺼짐 등)
    if (err) {
        console.error('❌ [DATABASE] 연결 실패! 정보를 확인하세요.');
        console.error('에러 상세 내용:', err.message); // 구체적인 에러 이유 출력
        return; // 연결 실패 시 함수 종료
    }
    
    // 연결에 성공했을 때 터미널에 출력되는 반가운 메시지
    console.log('✅ [DATABASE] MySQL 데이터베이스 연결 성공! 모든 시스템 준비 완료.');
});

// ---------------------------------------------------------
// 4. 연결 객체 내보내기 (공유하기)
// ---------------------------------------------------------
// api.js나 scheduler.js 등에서 'db.query' 명령을 내릴 수 있도록 이 객체를 내보냅니다.
// 이로써 프로젝트 전체에서 단 하나의 연결 통로를 공유하게 됩니다.
module.exports = db;